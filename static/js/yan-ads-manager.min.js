class YANAdsManager{constructor(e){this.defaultConfig={blockIds:[],auto_refresh:!0,refresh_time:30,floating_banner:{enable:!0,delay:1,delayAfterClose:60,max_width:"300px",max_height:"250px"},anchor_ads:{enable:!0,delay:1,delayAfterClose:60,max_width:"100%",max_height:"100px"},reward_ads:{enable:!1,trigger:null,auto_close:!1,watch_time:5,max_width:"60%",max_height:"80%",title:"Advertisements",on_close:null}},this.config=this.deepMerge(this.defaultConfig,e),this.activeAds={floating_banner:null,anchor_ads:null,reward_ads:null,inpage_banners:[]},this.timers={refresh:null,floatingBanner:null,anchorAd:null,rewardAd:null,visibilityCheck:null},this.windowVisible=!0,this.lastRefreshTime=0,this.init()}deepMerge(e,t){for(const n in t)t[n]instanceof Object&&n in e&&Object.assign(t[n],this.deepMerge(e[n],t[n]));return Object.assign(e||{},t),e}init(){this.injectStyles(),this.setupVisibilityListeners(),this.processInPageAds(),this.config.floating_banner.enable&&this.initFloatingBanner(),this.config.anchor_ads.enable&&this.initAnchorAd(),this.config.reward_ads.enable&&this.initRewardAd(),this.config.auto_refresh&&this.setupAutoRefresh()}setupVisibilityListeners(){const e=void 0!==document.hidden?"hidden":void 0!==document.msHidden?"msHidden":void 0!==document.webkitHidden?"webkitHidden":null,t=e?e.replace(/hidden/i,"visibilitychange"):null;t&&document.addEventListener(t,(()=>{this.windowVisible=!document[e],this.handleVisibilityChange()}),!1),window.addEventListener("focus",(()=>{this.windowVisible=!0,this.handleVisibilityChange()})),window.addEventListener("blur",(()=>{this.windowVisible=!1,this.handleVisibilityChange()})),this.timers.visibilityCheck=setInterval((()=>{const e=document.hasFocus();e!==this.windowVisible&&(this.windowVisible=e,this.handleVisibilityChange())}),1e3)}handleVisibilityChange(){if(this.windowVisible){const e=Date.now();(e-this.lastRefreshTime)/1e3>=this.config.refresh_time&&(this.refreshAllAds(),this.lastRefreshTime=e)}}ga_send_event=e=>{"function"==typeof gtag&&gtag("event",e,{event_name:e})};injectStyles(){const e=document.createElement("style");e.textContent="\n            /* Base styles for all ad types */\n            .yan-ad-container {\n                position: relative;\n                overflow: hidden;\n                margin: 0 auto;\n                background-color: #f9f9f9 !important;\n                box-sizing: border-box;\n            }\n            \n            .yan-ad-close {\n                position: absolute;\n                top: 5px;\n                right: 5px;\n                width: 20px;\n                height: 20px;\n                cursor: pointer;\n                border: 0px;\n                z-index: 100;\n                background: #666666;\n                border-radius: 50%;\n                display: flex;\n                align-items: center;\n                justify-content: center;\n                transition: opacity 0.2s ease;\n            }\n            \n            .yan-ad-close:hover {\n                opacity: 0.8;\n            }\n            \n            .yan-ad-close:disabled {\n                opacity: 0.5;\n                cursor: not-allowed;\n            }\n            \n            .yan-ad-close svg {\n                width: 12px;\n                height: 12px;\n                fill: white;\n            }\n            \n            .yan-ad-iframe {\n                width: 100%;\n                height: 100%;\n                border: none;\n                display: block;\n            }\n            \n            /* Floating banner specific styles */\n            .yan-floating-banner {\n                position: fixed;\n                z-index: 9999;\n                bottom: 20px;\n                right: 20px;\n                box-shadow: 0 2px 6px rgba(0,0,0,0.08);\n                border-radius: 4px;\n                transition: transform 0.3s ease;\n                transform: translateX(110%);\n            }\n            \n            .yan-floating-banner.visible {\n                transform: translateX(0);\n            }\n            \n            /* Anchor ads specific styles */\n            .yan-anchor-ad {\n                position: fixed;\n                z-index: 9998;\n                left: 0;\n                right: 0;\n                bottom: 0;\n                transform: translateY(100%);\n                transition: transform 0.3s ease;\n                box-shadow: 0 -1px 4px rgba(0,0,0,0.04);\n            }\n            \n            .yan-anchor-ad.visible {\n                transform: translateY(0);\n            }\n            \n            /* Reward ads specific styles */\n            .yan-reward-ad-overlay {\n                position: fixed;\n                top: 0;\n                left: 0;\n                right: 0;\n                bottom: 0;\n                background-color: rgba(0,0,0,0.7);\n                z-index: 1000000;\n                display: flex;\n                align-items: center;\n                justify-content: center;\n                opacity: 0;\n                visibility: hidden;\n                transition: opacity 0.3s ease, visibility 0.3s ease;\n            }\n            \n            .yan-reward-ad-overlay.visible {\n                opacity: 1;\n                visibility: visible;\n            }\n            \n            .yan-reward-ad-container {\n                background: white !important;\n                border-radius: 8px;\n                overflow: hidden;\n                position: relative;\n                box-shadow: 0 4px 12px rgba(0,0,0,0.1);\n            }\n            \n            .yan-reward-ad-header {\n                padding: 10px;\n                background: #fcfcfc !important;\n                text-align: left;\n                font-family: sans-serif !important;\n                font-size: 12px !important;\n                font-weight: bold;\n                border-bottom: 1px solid #f0f0f0 !important;\n                position: relative;\n            }\n            \n            .yan-reward-ad-timer {\n                position: absolute;\n                right: 50px;\n                top: 50%;\n                transform: translateY(-50%);\n                font-size: 14px;\n                color: #666;\n            }\n            \n            /* In-page banner ads */\n            .yan-inpage-banner {\n                width: 100%;\n                margin: 10px 0;\n            }\n            \n            /* Responsive adjustments */\n            @media (max-width: 768px) {\n                .yan-floating-banner {\n                    max-width: 250px !important;\n                    max-height: 250px !important;\n                }\n                \n                .yan-reward-ad-container {\n                    width: 90% !important;\n                    height: auto !important;\n                }\n            }\n        ",document.head.appendChild(e)}processInPageAds(){document.querySelectorAll(".AdYan").forEach(((e,t)=>{const n=document.createElement("div");n.className="yan-ad-container yan-inpage-banner";const i=e.dataset.maxWidth||"100%",a=e.dataset.maxHeight||"auto";n.style.maxWidth=i,n.style.maxHeight=a,n.style.width="100%","auto"===a?(n.style.height="0",n.style.paddingBottom="56.25%"):n.style.height=a;const s=document.createElement("iframe");s.className="yan-ad-iframe",s.setAttribute("frameborder","0"),s.setAttribute("scrolling","no"),n.appendChild(s),e.replaceWith(n),this.loadAd(n,"inpage_banner"),this.activeAds.inpage_banners.push({element:n,iframe:s})}))}initFloatingBanner(){const e=document.createElement("div");e.className="yan-ad-container yan-floating-banner",e.style.maxWidth=this.config.floating_banner.max_width,e.style.maxHeight=this.config.floating_banner.max_height,e.style.width=this.config.floating_banner.max_width,e.style.height=this.config.floating_banner.max_height;const t=this.createCloseButton();e.appendChild(t);const n=document.createElement("iframe");n.className="yan-ad-iframe",n.setAttribute("frameborder","0"),n.setAttribute("scrolling","no"),e.appendChild(n),document.body.appendChild(e),this.activeAds.floating_banner={element:e,iframe:n,closeButton:t},t.addEventListener("click",(()=>this.closeFloatingBanner())),this.timers.floatingBanner=setTimeout((()=>{this.showFloatingBanner()}),1e3*this.config.floating_banner.delay)}showFloatingBanner(){this.activeAds.floating_banner&&(this.activeAds.floating_banner.adLoaded||(this.loadAd(this.activeAds.floating_banner.element,"floating_banner"),this.activeAds.floating_banner.adLoaded=!0),this.activeAds.floating_banner.element.classList.add("visible"))}closeFloatingBanner(){this.activeAds.floating_banner&&(this.activeAds.floating_banner.element.classList.remove("visible"),this.activeAds.floating_banner.adLoaded=!1,this.timers.floatingBanner=setTimeout((()=>{this.showFloatingBanner()}),1e3*this.config.floating_banner.delayAfterClose))}initAnchorAd(){const e=document.createElement("div");e.className="yan-ad-container yan-anchor-ad",e.style.maxWidth=this.config.anchor_ads.max_width,e.style.maxHeight=this.config.anchor_ads.max_height,e.style.width=this.config.anchor_ads.max_width,e.style.height=this.config.anchor_ads.max_height;const t=this.createCloseButton();e.appendChild(t);const n=document.createElement("iframe");n.className="yan-ad-iframe",n.setAttribute("frameborder","0"),n.setAttribute("scrolling","no"),e.appendChild(n),document.body.appendChild(e),this.activeAds.anchor_ads={element:e,iframe:n,closeButton:t},t.addEventListener("click",(()=>this.closeAnchorAd())),this.timers.anchorAd=setTimeout((()=>{this.showAnchorAd()}),1e3*this.config.anchor_ads.delay)}showAnchorAd(){this.activeAds.anchor_ads&&(this.activeAds.anchor_ads.adLoaded||(this.loadAd(this.activeAds.anchor_ads.element,"anchor_ads"),this.activeAds.anchor_ads.adLoaded=!0),this.activeAds.anchor_ads.element.classList.add("visible"))}closeAnchorAd(){this.activeAds.anchor_ads&&(this.activeAds.anchor_ads.element.classList.remove("visible"),this.activeAds.anchor_ads.adLoaded=!1,this.timers.anchorAd=setTimeout((()=>{this.showAnchorAd()}),1e3*this.config.anchor_ads.delayAfterClose))}initRewardAd(){const e=document.createElement("div");e.className="yan-reward-ad-overlay";const t=document.createElement("div");t.className="yan-reward-ad-container",t.style.maxWidth=this.config.reward_ads.max_width,t.style.maxHeight=this.config.reward_ads.max_height,t.style.width=this.config.reward_ads.max_width,t.style.height=this.config.reward_ads.max_height;const n=document.createElement("div");n.className="yan-reward-ad-header",n.textContent=this.config.reward_ads.title;const i=document.createElement("div");i.className="yan-reward-ad-timer",i.style.display="none",n.appendChild(i),t.appendChild(n);const a=this.createCloseButton();a.style.position="absolute",a.style.top="8px",a.style.right="8px",a.style.background="transparent",a.style.border="none",a.style.background="#666666",a.disabled=!0,t.appendChild(a);const s=document.createElement("div");s.className="yan-ad-container",s.style.width="100%",s.style.height="calc(100% - 50px)";const d=document.createElement("iframe");if(d.className="yan-ad-iframe",d.setAttribute("frameborder","0"),d.setAttribute("scrolling","no"),s.appendChild(d),t.appendChild(s),e.appendChild(t),document.body.appendChild(e),this.activeAds.reward_ads={overlay:e,container:t,adContainer:s,iframe:d,closeButton:a,timerDisplay:i,isWatched:!1,watchTimer:null,remainingTime:0},a.addEventListener("click",(()=>this.closeRewardAd(!1))),this.config.reward_ads.trigger){const e="string"==typeof this.config.reward_ads.trigger?document.querySelector(this.config.reward_ads.trigger):this.config.reward_ads.trigger;e&&e.addEventListener("click",(e=>{e.preventDefault(),this.showRewardAd()}))}}showRewardAd(){this.activeAds.reward_ads&&(this.activeAds.reward_ads.isWatched=!1,this.activeAds.reward_ads.remainingTime=this.config.reward_ads.watch_time,this.loadAd(this.activeAds.reward_ads.adContainer,"reward_ads"),this.activeAds.reward_ads.overlay.classList.add("visible"),this.activeAds.reward_ads.closeButton.style.display="flex",this.activeAds.reward_ads.closeButton.disabled=!0,this.activeAds.reward_ads.timerDisplay.style.display="block",this.activeAds.reward_ads.timerDisplay.style.fontSize="11px",this.activeAds.reward_ads.timerDisplay.style.fontFamily="sans-serif",this.activeAds.reward_ads.timerDisplay.style.fontWeight="bold",this.activeAds.reward_ads.timerDisplay.style.color="#666",this.activeAds.reward_ads.timerDisplay.textContent=`${this.activeAds.reward_ads.remainingTime} seconds`,this.activeAds.reward_ads.watchTimer=setInterval((()=>{this.activeAds.reward_ads.remainingTime--,this.activeAds.reward_ads.timerDisplay.textContent=`${this.activeAds.reward_ads.remainingTime} seconds`,this.activeAds.reward_ads.remainingTime<=0&&(this.activeAds.reward_ads.closeButton.disabled=!1,this.activeAds.reward_ads.timerDisplay.style.display="none",this.config.reward_ads.auto_close&&this.closeRewardAd(!0))}),1e3))}closeRewardAd(e){this.activeAds.reward_ads&&(this.activeAds.reward_ads.watchTimer&&(clearInterval(this.activeAds.reward_ads.watchTimer),this.activeAds.reward_ads.watchTimer=null),this.activeAds.reward_ads.timerDisplay.style.display="none",this.activeAds.reward_ads.isWatched=e,this.activeAds.reward_ads.overlay.classList.remove("visible"),this.activeAds.reward_ads.closeButton.disabled=!0,this.config.reward_ads.on_close&&"function"==typeof this.config.reward_ads.on_close&&this.config.reward_ads.on_close(e))}createCloseButton(){const e=document.createElement("button");return e.className="yan-ad-close",e.innerHTML='\n            <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">\n                <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>\n            </svg>\n        ',e}loadAd(e,t){if(!this.config.blockIds||0===this.config.blockIds.length)return void console.error("No blockIds provided in configuration");this.ga_send_event(t),this.ga_send_event("Ad_Impression");const n=this.config.blockIds[Math.floor(Math.random()*this.config.blockIds.length)],i=e.querySelector(".yan-ad-iframe");if(!i)return void console.error("No iframe found in ad container");const a=`\n            <!DOCTYPE html>\n            <html>\n            <head>\n                <meta charset="utf-8">\n                <meta name="viewport" content="width=device-width, initial-scale=1.0">\n                \x3c!-- Yandex.RTB --\x3e\n                <script>window.yaContextCb=window.yaContextCb||[]<\/script>\n                <script src="https://yandex.ru/ads/system/context.js" async><\/script>\n            </head>\n            <body style="margin:0;padding:0;">\n                \x3c!-- Yandex.RTB ${n} --\x3e\n                <div id="yandex_rtb_${n}" style="width:100%;height:100%;"></div>\n                <script>\n                window.yaContextCb.push(() => {\n                    Ya.Context.AdvManager.render({\n                        "blockId": "${n}",\n                        "renderTo": "yandex_rtb_${n}"\n                    })\n                })\n                <\/script>\n            </body>\n            </html>\n        `;if(i.srcdoc=a,"floating_banner"===t&&this.activeAds.floating_banner)this.activeAds.floating_banner.blockId=n;else if("anchor_ads"===t&&this.activeAds.anchor_ads)this.activeAds.anchor_ads.blockId=n;else if("reward_ads"===t&&this.activeAds.reward_ads)this.activeAds.reward_ads.blockId=n;else if("inpage_banner"===t){const t=Array.from(document.querySelectorAll(".yan-inpage-banner")).indexOf(e);-1!==t&&this.activeAds.inpage_banners[t]&&(this.activeAds.inpage_banners[t].blockId=n)}}refreshAllAds(){this.windowVisible&&(this.activeAds.floating_banner&&this.activeAds.floating_banner.element.classList.contains("visible")&&this.loadAd(this.activeAds.floating_banner.element,"floating_banner"),this.activeAds.anchor_ads&&this.activeAds.anchor_ads.element.classList.contains("visible")&&this.loadAd(this.activeAds.anchor_ads.element,"anchor_ads"),this.activeAds.inpage_banners.forEach(((e,t)=>{this.loadAd(e.element,"inpage_banner")})),this.lastRefreshTime=Date.now())}setupAutoRefresh(){this.timers.refresh=setInterval((()=>{const e=(Date.now()-this.lastRefreshTime)/1e3;this.windowVisible&&e>=this.config.refresh_time&&this.refreshAllAds()}),1e3)}destroy(){Object.values(this.timers).forEach((e=>{e&&clearTimeout(e)})),this.timers.refresh&&clearInterval(this.timers.refresh),this.activeAds.floating_banner&&this.activeAds.floating_banner.element.remove(),this.activeAds.anchor_ads&&this.activeAds.anchor_ads.element.remove(),this.activeAds.reward_ads&&this.activeAds.reward_ads.overlay.remove(),document.removeEventListener("visibilitychange",this.handleVisibilityChange),window.removeEventListener("focus",this.handleVisibilityChange),window.removeEventListener("blur",this.handleVisibilityChange),this.activeAds={floating_banner:null,anchor_ads:null,reward_ads:null,inpage_banners:[]}}}"undefined"!=typeof module&&module.exports?module.exports=YANAdsManager:window.YANAdsManager=YANAdsManager;