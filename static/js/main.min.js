let selectedImages=[],pdfDoc=null;document.addEventListener("DOMContentLoaded",(function(){const e=document.getElementById("dropArea"),t=document.getElementById("fileInput"),n=document.getElementById("selectImagesBtn"),a=document.getElementById("imageList"),o=document.getElementById("imageCount"),s=document.getElementById("conversionContainer"),l=document.querySelector(".upload-container"),d=document.getElementById("convertBtn"),i=document.getElementById("downloadBtn"),c=document.getElementById("resetBtn"),r=document.getElementById("progressContainer"),m=document.getElementById("progressBar"),u=document.getElementById("progressPercent"),g=document.getElementById("margin"),p=document.getElementById("marginValue");function f(){p.textContent=`${g.value}mm`}function h(e){let t=[];for(let n=0;n<e.length;n++){const a=e[n];a.type.startsWith("image/")?t.push(a):b(`Skipped ${a.name} - Not an image file`,"error")}t.length>0?function(e){e.forEach((e=>{const t=new FileReader;t.onload=function(t){const n=new Image;n.src=t.target.result,n.onload=function(){const a={file:e,name:e.name,size:v(e.size),src:t.target.result,width:n.width,height:n.height,type:e.type};selectedImages.push(a),y(),1===selectedImages.length&&(s.style.display="block",d.style.display="block",c.style.display="block",l.style.display="none")}},t.readAsDataURL(e)})),b(`${e.length} image(s) added successfully`,"success")}(t):b("No valid image files selected","error")}function y(){a.innerHTML="",selectedImages.forEach(((e,t)=>{const n=document.createElement("div");n.className="col";const o=document.createElement("div");o.className="image-card rounded-3 shadow-sm",o.setAttribute("data-index",t),o.innerHTML=`\n                <button class="btn btn-sm btn-danger remove-btn" data-index="${t}"><i class="bi bi-x"></i></button>\n                <img src="${e.src}" class="card-img-top rounded-3" alt="${e.name}" />\n                <small class="image-list-title text-truncate rounded-bottom-3">${e.name}</small>\n            `,n.appendChild(o),a.appendChild(n)})),document.querySelectorAll(".remove-btn").forEach((e=>{e.addEventListener("click",(function(){!function(e){selectedImages.splice(e,1),y(),b("Image removed","warning")}(parseInt(this.getAttribute("data-index")))}))})),o.textContent=selectedImages.length,s.style.display=selectedImages.length?"block":"none",0===selectedImages.length&&(s.style.display="none",i.style.display="none",c.style.display="none",l.style.display="block")}function b(e,t){const n=document.querySelector(".toast-container"),a=document.createElement("div");a.className=`toast toast-${t} show`,a.setAttribute("role","alert"),a.setAttribute("aria-live","assertive"),a.setAttribute("aria-atomic","true"),a.innerHTML=`\n            <div class="toast-header">\n                <strong class="me-auto">${t.charAt(0).toUpperCase()+t.slice(1)}</strong>\n                <small>Just now</small>\n                <button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Close"></button>\n            </div>\n            <div class="toast-body">\n                <i class="bi ${"success"===t?"bi-check-circle-fill":"error"===t?"bi-exclamation-circle-fill":"bi-exclamation-triangle-fill"} me-2"></i>\n                ${e}\n            </div>\n        `,n.appendChild(a),setTimeout((()=>{a.classList.remove("show"),setTimeout((()=>a.remove()),300)}),5e3);new bootstrap.Toast(a).show()}function v(e){if(0===e)return"0 Bytes";const t=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,t)).toFixed(2))+" "+["Bytes","KB","MB","GB"][t]}new Sortable(a,{animation:150,ghostClass:"sortable-ghost",onEnd:function(){const e=a.querySelectorAll(".image-card"),t=Array.from(e).map((e=>{const t=parseInt(e.getAttribute("data-index"));return selectedImages[t]}));selectedImages=t}}),n.addEventListener("click",(()=>t.click())),t.addEventListener("change",(function(e){const t=e.target.files;t.length&&h(t)})),e.addEventListener("dragover",(function(t){t.preventDefault(),t.stopPropagation(),e.classList.add("highlight")})),e.addEventListener("dragleave",(function(t){t.preventDefault(),t.stopPropagation(),e.classList.remove("highlight")})),e.addEventListener("drop",(function(t){t.preventDefault(),t.stopPropagation(),e.classList.remove("highlight");const n=t.dataTransfer.files;n.length&&h(n)})),d.addEventListener("click",(function(){if(0===selectedImages.length)return void b("No images to convert","error");r.style.display="block",m.style.width="0%",u.textContent="0%",d.disabled=!0,c.disabled=!0;const e=document.getElementById("pageOrientation").value,t=document.getElementById("pageSize").value,n=document.getElementById("backgroundColor").value,a=document.getElementById("imagePosition").value,o=parseInt(document.getElementById("margin").value),{jsPDF:s}=(document.getElementById("pdfName").value,window.jspdf);pdfDoc=new s;let l=0;const g=()=>{if(l>=selectedImages.length)return m.style.width="100%",u.textContent="100%",void setTimeout((()=>{r.style.display="none",i.style.display="inline-block",d.disabled=!1,c.disabled=!1,b("PDF conversion complete!","success")}),500);const p=selectedImages[l],f=new Image;f.src=p.src,f.onload=function(){let d,i;if("auto"===t){const e=25.4/96;d=f.width*e,i=f.height*e,d=Math.max(d,10),i=Math.max(i,10)}else{switch(t){case"a4":default:d=210,i=297;break;case"letter":d=215.9,i=279.4;break;case"legal":d=215.9,i=355.6;break;case"tabloid":d=279.4,i=431.8}("landscape"===e||"auto"===e&&f.width>f.height)&&([d,i]=[i,d])}l>0?pdfDoc.addPage([d,i],"landscape"===e?"l":"p"):pdfDoc=new s({orientation:d>i?"l":"p",unit:"mm",format:[d,i]}),"#ffffff"!==n&&(pdfDoc.setFillColor(n),pdfDoc.rect(0,0,d,i,"F"));const c=d-2*o,r=i-2*o,h=f.width/f.height;let y,b,v,I;switch("stretch"===a?(y=c,b=r):h>c/r?(y=c,b=c/h):(b=r,y=r*h),a){case"center":default:v=o+(c-y)/2,I=o+(r-b)/2;break;case"top-left":case"stretch":v=o,I=o;break;case"top-right":v=o+c-y,I=o;break;case"bottom-left":v=o,I=o+r-b;break;case"bottom-right":v=o+c-y,I=o+r-b}pdfDoc.addImage({imageData:f.src,x:v,y:I,width:y,height:b,format:p.type.split("/")[1].toUpperCase()}),l++;const E=Math.round(l/selectedImages.length*100);m.style.width=`${E}%`,u.textContent=`${E}%`,setTimeout(g,100)},f.onerror=function(){b(`Failed to load image: ${p.name}`,"error"),l++;const e=Math.round(l/selectedImages.length*100);m.style.width=`${e}%`,u.textContent=`${e}%`,setTimeout(g,100)}};g()})),i.addEventListener("click",(function(){if(!pdfDoc)return void b("No PDF to download","error");const e=document.getElementById("pdfName").value||"output.pdf";pdfDoc.save(e.endsWith(".pdf")?e:`${e}.pdf`),b("PDF downloaded successfully","success")})),c.addEventListener("click",(function(){selectedImages=[],pdfDoc=null,t.value="",y(),r.style.display="none",d.style.display="none",i.style.display="none",l.style.display="block",d.disabled=!1,c.disabled=!1,document.getElementById("pageOrientation").value="portrait",document.getElementById("pageSize").value="a4",document.getElementById("backgroundColor").value="#ffffff",document.getElementById("imagePosition").value="center",document.getElementById("margin").value="10",document.getElementById("pdfName").value="",f(),b("Application reset","warning")})),g.addEventListener("input",f)})),document.addEventListener("DOMContentLoaded",(function(){const e=document.querySelector(".floating-icons"),t=["bi-filetype-pdf","bi-card-image","bi-cloud-upload-fill","bi-download","bi-file","bi-images"];for(let n=0;n<8;n++){const n=document.createElement("i");n.className=`floating-icon bi ${t[Math.floor(Math.random()*t.length)]}`,n.style.left=90*Math.random()+5+"%",n.style.top=90*Math.random()+5+"%",n.style.fontSize=15*Math.random()+15+"px",n.style.animationDelay=10*Math.random()+"s",n.style.animationDuration=10*Math.random()+10+"s",e.appendChild(n)}}));
